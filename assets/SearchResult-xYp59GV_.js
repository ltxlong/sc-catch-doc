import{e as X,u as Z,f as I,h as ee,P as se,t as te,i as le,j as L,k as R,l as t,m as ae,w as O,p as ue,R as P,q as ce,s as re,v as ie,x as ne,y as oe,z as $,A as T,C as de,B as he,D as ve,E as me,F as pe,G as ye,H as fe,I as U,J as _e,K as x}from"./app-DVtwqrw_.js";const ge=["/","/desc/","/desc/func/","/desc/func/activity_use.html","/desc/func/auto_clean.html","/desc/func/auto_click_dm_combo.html","/desc/func/auto_click_tianxuan.html","/desc/func/blacklist.html","/desc/func/circle_welt_hidden.html","/desc/func/custom_data_show.html","/desc/func/custom_font_size.html","/desc/func/custom_height.html","/desc/func/custom_sc_expire.html","/desc/func/custom_sc_search.html","/desc/func/custom_sc_show.html","/desc/func/custom_sc_sort.html","/desc/func/custom_side_fold_button.html","/desc/func/custom_width.html","/desc/func/drag.html","/desc/func/export.html","/desc/func/fold_and_show.html","/desc/func/fullscreen_use.html","/desc/func/hidden_sc_send_timestamp.html","/desc/func/memory.html","/desc/func/multi_theme.html","/desc/func/right_click_menu.html","/desc/func/sc_fold.html","/desc/func/sc_gen_image.html","/desc/func/sc_to_danmu_show.html","/desc/func/separate_memory.html","/desc/func/side_fold.html","/desc/func/special_tip.html","/desc/func/sync_data.html","/desc/get/","/desc/get/install.html","/404.html"],He="SEARCH_PRO_QUERY_HISTORY",y=U(He,[]),ke=()=>{const{queryHistoryCount:a}=x;return{enabled:a>0,queryHistory:y,addQueryHistory:r=>{y.value=Array.from(new Set([r,...y.value.slice(0,a-1)]))},removeQueryHistory:r=>{y.value=[...y.value.slice(0,r),...y.value.slice(r+1)]}}},b=a=>ge[a.id]+("anchor"in a?`#${a.anchor}`:""),we="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:j}=x,f=U(we,[]),Re=()=>({enabled:j>0,resultHistory:f,addResultHistory:u=>{{const r={link:b(u),display:u.display};"header"in u&&(r.header=u.header),f.value=[r,...f.value.slice(0,j-1)]}},removeResultHistory:u=>{f.value=[...f.value.slice(0,u),...f.value.slice(u+1)]}}),xe=a=>{const u=de(),r=I(),Q=he(),i=L(0),_=R(()=>i.value>0),h=ve([]);return me(()=>{const{search:q,terminate:v}=pe(),g=ye(p=>{const H=p.join(" "),{searchFilter:m=l=>l,splitWord:A,suggestionsFilter:c,...n}=u.value;H?(i.value+=1,q(p.join(" "),r.value,n).then(l=>m(l,H,r.value,Q.value)).then(l=>{i.value-=1,h.value=l}).catch(l=>{console.warn(l),i.value-=1,i.value||(h.value=[])})):h.value=[]},x.searchDelay-x.suggestDelay);O([a,r],([p])=>g(p),{immediate:!0}),fe(()=>{v()})}),{isSearching:_,results:h}};var qe=X({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:u}){const r=Z(),Q=I(),i=ee(se),{addQueryHistory:_,queryHistory:h,removeQueryHistory:q}=ke(),{resultHistory:v,addResultHistory:g,removeResultHistory:p}=Re(),H=te(a,"queries"),{results:m,isSearching:A}=xe(H),c=le({isQuery:!0,index:0}),n=L(0),l=L(0),E=R(()=>h.value.length>0||v.value.length>0),C=R(()=>m.value.length>0),S=R(()=>m.value[n.value]||null),Y=()=>{const{isQuery:e,index:s}=c;s===0?(c.isQuery=!e,c.index=e?v.value.length-1:h.value.length-1):c.index=s-1},z=()=>{const{isQuery:e,index:s}=c;s===(e?h.value.length-1:v.value.length-1)?(c.isQuery=!e,c.index=0):c.index=s+1},B=()=>{n.value=n.value>0?n.value-1:m.value.length-1,l.value=S.value.contents.length-1},M=()=>{n.value=n.value<m.value.length-1?n.value+1:0,l.value=0},G=()=>{l.value<S.value.contents.length-1?l.value+=1:M()},J=()=>{l.value>0?l.value-=1:B()},D=e=>e.map(s=>_e(s)?s:t(s[0],s[1])),K=e=>{if(e.type==="customField"){const s=ne[e.index]||"$content",[o,w=""]=oe(s)?s[Q.value].split("$content"):s.split("$content");return e.display.map(d=>t("div",D([o,...d,w])))}return e.display.map(s=>t("div",D(s)))},k=()=>{n.value=0,l.value=0,u("updateQuery",""),u("close")},V=()=>t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},i.value.queryHistory),h.value.map((e,s)=>t("div",{class:["search-pro-result-item",{active:c.isQuery&&c.index===s}],onClick:()=>{u("updateQuery",e)}},[t($,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},e),t("button",{class:"search-pro-remove-icon",innerHTML:T,onClick:o=>{o.preventDefault(),o.stopPropagation(),q(s)}})]))])),N=()=>t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},i.value.resultHistory),v.value.map((e,s)=>t(P,{to:e.link,class:["search-pro-result-item",{active:!c.isQuery&&c.index===s}],onClick:()=>{k()}},()=>[t($,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(o=>D(o)).flat())]),t("button",{class:"search-pro-remove-icon",innerHTML:T,onClick:o=>{o.preventDefault(),o.stopPropagation(),p(s)}})]))]));return ae("keydown",e=>{if(a.isFocusing){if(C.value){if(e.key==="ArrowUp")J();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const s=S.value.contents[l.value];_(a.queries.join(" ")),g(s),r.push(b(s)),k()}}else if(e.key==="ArrowUp")Y();else if(e.key==="ArrowDown")z();else if(e.key==="Enter"){const{index:s}=c;c.isQuery?(u("updateQuery",h.value[s]),e.preventDefault()):(r.push(v.value[s].link),k())}}}),O([n,l],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["search-pro-result-wrapper",{empty:a.queries.length?!C.value:!E.value}],id:"search-pro-results"},a.queries.length?A.value?t(ue,{hint:i.value.searching}):C.value?t("ul",{class:"search-pro-result-list"},m.value.map(({title:e,contents:s},o)=>{const w=n.value===o;return t("li",{class:["search-pro-result-list-item",{active:w}]},[t("div",{class:"search-pro-result-title"},e||i.value.defaultTitle),s.map((d,W)=>{const F=w&&l.value===W;return t(P,{to:b(d),class:["search-pro-result-item",{active:F,"aria-selected":F}],onClick:()=>{_(a.queries.join(" ")),g(d),k()}},()=>[d.type==="text"?null:t(d.type==="title"?ce:d.type==="heading"?re:ie,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[d.type==="text"&&d.header?t("div",{class:"content-header"},d.header):null,t("div",K(d))])])})])})):i.value.emptyResult:E.value?[V(),N()]:i.value.emptyHistory)}});export{qe as default};
